<form id="myForm">
  <input type="text" name="username" placeholder="Enter your name"><br><br>
  <video id="video" autoplay></video><br>
  <button type="button" id="captureBtn">ðŸ“· Capture</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <input type="hidden" name="image" id="imageData">
  <br><br>
  <button type="submit">Send</button>
</form>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const imageDataInput = document.getElementById('imageData');

navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
    video.srcObject = stream;
});

document.getElementById('captureBtn').onclick = () => {
    const ctx = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    imageDataInput.value = canvas.toDataURL("image/jpeg"); // base64
};

document.getElementById('myForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);

    const res = await fetch("/upload", {
        method: "POST",
        body: formData
    });
    alert(await res.text());
};
</script>
