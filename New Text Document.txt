<!DOCTYPE html>
<html >
<head>
    <meta charset="UTF-8">
    <title>بحث النقاط</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 8px; }
        th { background-color: #f0f0f0; }
    </style>
</head>
<body>
    <h2>بحث النقاط حسب المشروع والتاريخ</h2>
    <label>id_project:</label>
    <input type="number" id="project_id_input">
    <br><br>
    <label>data:</label>
    <input type="date" id="data_tame_input">
    <br><br>
    <button onclick="searchPoints()">بحث</button>

    <div id="results"></div>

    <script>
        // جعل القيمه الافتراضيه هي اليوم
        // نجيب خانة الإدخال
         const dateInput = document.getElementById("data_tame_input");

         // نولّد تاريخ اليوم بصيغة YYYY-MM-DD
         const today = new Date().toISOString().split("T")[0];

        // نضبط القيمة الافتراضية
        dateInput.value = today;
        //=====================

  const params = new URLSearchParams(window.location.search);
  document.getElementById("project_id_input").value = params.get("id");
        async function searchPoints() {
            const project_id_input = document.getElementById("project_id_input").value;
            const data_tame_input = document.getElementById("data_tame_input").value;

            let url = `http://127.0.0.1:8001/search_points?`;
            if (project_id_input) url += `project_id_input=${project_id_input}&`;
            if (data_tame_input) url += `data_tame_input=${encodeURIComponent(data_tame_input)}&`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                let html = "";
                if (data.length === 0) {
                    html = "<p>لا توجد نتائج مطابقة.</p>";
                } else {
                    html = "<h3>نتائج البحث</h3>";
                    html += "<table><tr><th>№</th><th>name_point</th><th>data</th><th>tame</th></tr>";
                    data.forEach((row, index) => {
                        html += `<tr>
                            <td>${index + 1}</td>
                            <td>${row.name_point}</td>
                            <td>${row.dataD}</td>
                            <td>${row.timeD}</td>
                        </tr>`;
                    });
                    html += "</table>";
                }

                document.getElementById("results").innerHTML = html;
            } catch (err) {
                document.getElementById("results").innerHTML = "<p>حدث خطأ أثناء جلب البيانات.</p>";
            }
        }
        // ✅ تنفيذ الدالة تلقائياً عند تحميل الصفحة
        window.onload = searchPoints;
    </script>
</body>
</html>
