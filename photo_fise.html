<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>كاميرا بدائرة وعداد ومعلومات</title>
<style>
  body {
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background-color: black;
    font-family: Arial, sans-serif;
    color: white;
  }

  .camera-container {
    position: relative;
    width: 400px;
    max-width: 90%;
  }

  video {
    width: 100%;
    border-radius: 10px;
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
  }

  #captureBtn {
    margin-top: 15px;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    background-color: #59c25d;
    color: white;
    cursor: pointer;
  }

  #info {
    margin-top: 15px;
    width: 400px;
    max-width: 90%;
    background: rgba(202, 147, 147, 0.1);
    padding: 10px;
    border-radius: 10px;
    font-size: 14px;
  }
</style>
</head>
<body>

<div class="camera-container">
  <video id="video" autoplay playsinline></video>
  <canvas id="overlay"></canvas>
</div>

<button id="captureBtn">ابدأ</button>
<div id="info"></div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('overlay');
const ctx = canvas.getContext('2d');
const button = document.getElementById('captureBtn');
const infoDiv = document.getElementById('info');

navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      drawLoop();
    };
  })
  .catch(err => {
    alert("تعذر الوصول إلى الكاميرا: " + err);
  });

let timerActive = false;
let startTime = 0;
const duration = 101; // ثواني العداد
const radius = 75;

// رسم الدائرة والعداد
function drawLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const centerX = canvas.width / 3;
  const centerY = canvas.height / 3;

  // دائرة ثابتة
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
  ctx.strokeStyle = 'white';
  ctx.lineWidth = 4;
  ctx.stroke();

  // عداد دائري
  if (timerActive) {
    const elapsed = (Date.now() - startTime) / 1000;
    const angle = (elapsed / duration) * 2 * Math.PI;
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius + 10, -Math.PI/2, -Math.PI/2 + angle);
    ctx.strokeStyle = 'lime';
    ctx.lineWidth = 6;
    ctx.stroke();

    if (elapsed >= duration) {
      timerActive = false;
      window.location.href = 'try_Payroll.html'; // استبدل بالرابط
    }
  }

  requestAnimationFrame(drawLoop);
}

// عند الضغط على الزر: التقاط معلومات الصورة وبدء العداد
button.addEventListener('click', () => {
  // التقاط إطار مؤقت
  const tempCanvas = document.createElement('canvas');
  tempCanvas.width = video.videoWidth;
  tempCanvas.height = video.videoHeight;
  const tempCtx = tempCanvas.getContext('2d');
  tempCtx.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height);

  // استخراج معلومات الصورة
  const captureTime = new Date();
  const width = tempCanvas.width;
  const height = tempCanvas.height;
  const userAgent = navigator.userAgent;

  infoDiv.innerHTML = `
    <strong>وقت الالتقاط:</strong> ${captureTime.toLocaleString()}<br>
    <strong>أبعاد الفيديو:</strong> ${width} x ${height}<br>
    <strong>نوع الجهاز / المتصفح:</strong> ${userAgent}
  `;

  // بدء العداد
  timerActive = true;
  startTime = Date.now();
});
</script>

</body>
</html>
