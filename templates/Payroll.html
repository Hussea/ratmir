<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¼ĞµĞ½Ñ‹</title>
  <style>
     
    table, th, td { border: 1px solid #888686; border-collapse: collapse; padding: 8px; margin:2%; }
    table { width: 45%; margin-top: 20px; }
    th { background-color: #f0f0f0; }
    #status { margin-top: 10px; font-weight: bold; color: #444; }
    #show_pay_list_month_div{
  display: flex;
  flex-direction: column;
  padding: 20px;
  position: fixed;
  top: 10px;
  left: 52%;
  width: 35%;
  height: 5%;
  background-color: rgb(179, 179, 179);
  overflow: hidden;
  z-index: 1000;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  border-radius: 10px;
  font-family: sans-serif;
    }
    #fers_info{
      
      margin:2%;
    }
    #divPiy {
  display: flex;
  flex-direction: column;
  padding: 10px;
  position: fixed;
  top: 90px;
  left: 50%;
  width: 45%;
  height: 410px;
  background-color: rgb(179, 179, 179);
  overflow: hidden;
  z-index: 1000;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  border-radius: 10px;
  font-family: sans-serif;
}

#divPiy label {
  margin-bottom: 5px;
  font-weight: bold;
}

#divPiy input,
#divPiy select {
  width: 50%;
  padding: 8px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-sizing: border-box;
  font-size: 14px;
}

#notes {
  flex-grow: 1; /* ÙŠØ¬Ø¹Ù„ textarea ÙŠØ£Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© */
  resize: none;
  width: 100%;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 5px;
  margin-bottom: 15px;
  box-sizing: border-box;
  min-height: 100px;
}

 

.form-row {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
}

.form-row label {
  width: 100px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ù„ÙŠØ¨Ù„ */
  margin-right: 10px;
  font-weight: bold;
}

.form-row input {
  flex: 1;
  padding: 8px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 5px;
}
#show_pay_list_month {
  display: flex;
  flex-direction: column;
  padding: 20px;
  position: fixed;
  top: 10px;
  left:91%;
  width: 8%;
  height: 11%;
  background-color:#b2bec3;
  overflow: hidden;
  z-index: 1000;
  border-radius: 10px;
  font-family: sans-serif;
}

#show_pay_list_month:hover {
  background-color:#636e72 /* Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
}
#imgModal {
  display: none; 
  position: fixed; 
  z-index: 99999; /* Ø±Ù‚Ù… ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§ Ø¹Ø´Ø§Ù† ÙŠÙƒÙˆÙ† ÙÙˆÙ‚ ÙƒÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª */
  left: 0; 
  top: 0; 
  width: 100%; 
  height: 100%; 
  background-color: rgba(0,0,0,0.9); 
  justify-content: center; 
  align-items: center;
}

#imgModal img {
  max-width: 90%;
  max-height: 90%;
  border: 3px solid white;
  border-radius: 10px;
}

 /*==================== bar style start ================================ */
       body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f8;
    
    }

    .tabs {
      display: flex;
      background-color: #1e293b;
      overflow-x: auto;
    }

    .tabs button {
      flex: 1;
      padding: 16px;
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .tabs button:hover,
    .tabs button.active {
      background-color: #334155;
    }

    .tab-content {
      display: none;
      padding: 40px;
      background-color: #fff;
    }

    .tab-content.active {
      display: block;
    }

    .form-container {
      max-width: 1000px;
      margin: auto;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .form-container h2 {
      margin-bottom: 20px;
      color: #1e293b;
      font-size: 24px;
    }

    form label {
      display: block;
      margin-bottom: 6px;
      color: #475569;
      font-weight: 500;
    }

    form input,
    form select {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 16px;
    }

    form input[type="submit"] {
      background-color: #2563eb;
      color: white;
      border: none;
      font-weight: bold;
      transition: background 0.3s;
    }

    form input[type="submit"]:hover {
      background-color: #1d4ed8;
    }

    /* ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬ */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .full-width-form {
      max-width: none;
      width: 100%;
    }
    /*==================== bar style end ================================ */
    .big-icon {
      font-size: 30px; /* Ø­Ø¬Ù… Ø§Ù„Ø±Ù…Ø² */
      cursor: pointer; /* ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ø¤Ø´Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
      transition: transform 0.2s; /* Ø­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø© */
    }

    .big-icon:hover {
      transform: scale(5.2); /* ØªÙƒØ¨ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
    }
    
</style>
<body>
   <!--bar show start -->
  <script src="/static/js/header.js" defer></script>
 <my-header></my-header>
<!--bar show end -->
<div id="fers_info">
  <h2>ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¼ĞµĞ½Ñ‹</h2>

    <label for="start_day"> Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ğ´ Ğ¸ Ğ¼ĞµÑÑÑ†:</label>
    <input type="month" id="start_day" />
  
    
    <button onclick="loadData()">ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ</button>
    

<p id="status"> Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¼ĞµÑÑÑ† Ğ¸ Ğ³Ğ¾Ğ´ âš ï¸</p>
<p id="info_line">
  <span><strong> Ğ¤Ğ˜Ğ:</strong> <span id="show_employee_name"></span></span> |
  <br>
  <span><strong> Ğ’ ĞĞ±ĞµĞºÑ‚:</strong> <span id="show_projact_name"></span></span> |
  <span><strong> Ğ—ĞŸ :</strong> <span id="show_employee_sel"></span></span> |
  <span><strong> ÑĞ¼ĞµĞ½Ğ°:</strong> <span id="show_shift"></span></span> |
  <span><strong> ÑÑƒĞ¼Ğ° :</strong> <span id="show_sum"></span></span> 
</p>
</div>


<table id="data-table">
  <thead>
    <tr>
      <td>Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°</td>
      <td>Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°</td>
      <td>Ğ”Ğ°Ñ‚Ğ° Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ</td>
      <td>Ğ’Ñ€ĞµĞ¼Ñ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ</td>
      <td>Ñ„Ğ¾Ñ‚Ğ¾</td>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<script>
  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
  const today = new Date();
  // ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ ØµÙŠØºØ© YYYY-MM
  const month = today.toISOString().slice(0, 7);
  // ØªØ¹ÙŠÙŠÙ†Ù‡ ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù…Ø¯Ø®Ù„
  document.getElementById("start_day").value = month;
</script>

<script>
  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
  const params = new URLSearchParams(window.location.search);
  

  function loadData() {
    const empId = params.get("employee_id_input");
    const projId = params.get("project_id_input");
    const startDay = document.getElementById('start_day').value;
    document.getElementById("emp_id_send").value = params.get("employee_id_input");
    document.getElementById("proj_id_send").value = params.get("project_id_input");
    if (!empId || !projId || !startDay) {
      document.getElementById('status').textContent = 'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¼ĞµÑÑÑ† Ğ¸ Ğ³Ğ¾Ğ´ â—';
      return;
    }

    let apiUrl = `/show_work_shift?employee_id_input=${empId}&project_id_input=${projId}`;
    if (startDay) {
      apiUrl += `&start_day=${startDay}-01`;
    }

    
    document.getElementById('status').textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ğŸ”„...';
    document.getElementById('data-table').style.display = 'none';
    document.querySelector('#data-table tbody').innerHTML = '';

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        if (!data || data.length === 0) {
          document.getElementById('status').textContent = ' ĞĞµÑ‚ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… âŒ';
          return;
        }

        const tbody = document.querySelector('#data-table tbody');
        let total = 0;

        data.forEach(item => {
          const row = document.createElement('tr');
          const selEmp = Number(item.projuct_sel_emp || 0);
          total += selEmp;

          row.innerHTML = `
            <td>${item.start_day}</td>
            <td>${item.start_time}</td>
            <td>${item.end_day}</td>
            <td>${item.end_time}</td>
            <td> <img src="${item.file_path}" alt="Ğ½ĞµÑ‚ Ñ„Ğ¾Ñ‚Ğ¾" width="100" height="100"onclick="showImage(this)"></td>
          `;
          tbody.appendChild(row);
          document.getElementById('show_employee_name').textContent = `${item.employee_name}`;
          document.getElementById('show_projact_name').textContent = `${item.projuct_title}`;
          document.getElementById('show_employee_sel').textContent = `${item.projuct_sel_emp}`;
        });

        document.getElementById('data-table').style.display = 'table';
        document.getElementById('status').style.display = 'none';
        document.getElementById('show_shift').textContent = `${data.length}`;
        document.getElementById('show_sum').textContent = `${total}`;

      })
      .catch(err => {
        document.getElementById('status').textContent = 'ĞĞµÑ‚ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… âŒ';
        console.error(err);
      });
      
  }
</script>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙƒØ¨ÙŠØ± -->
<div id="imgModal" onclick="closeImage()">
  <img id="modalImg" src="">
</div>
<script>
function showImage(imgElement) {
  const modal = document.getElementById("imgModal");
  const modalImg = document.getElementById("modalImg");
  modal.style.display = "flex";
  modalImg.src = imgElement.src; // ÙŠÙ†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
}

function closeImage() {
  document.getElementById("imgModal").style.display = "none";
}
</script>
<form id="employee-form" onsubmit="submitForm(event)">
<div id="form-message"></div>
   
  <input type="number" id="emp_id_send" name="emp_id_send" style="display: none;"/>
  <input type="number" id="proj_id_send" name="proj_id_send" style="display: none;"/>

<div id="divPiy" >
  
  <p id="info_line1">
  <strong>ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶:</strong> 
  <span><strong> Ñ‚Ğ¸Ğ¿:</strong> <span id="show_employee_name_salry"></span></span> |
  <span><strong> Ğ—Ğ°:</strong> <span id="show_projact_name_salry"></span></span> |
  <span><strong> ÑÑƒĞ¼Ğ° :</strong> <span id="show_sum_salry"></span></span> 
  <button id="goToSalaryHistoryBtn">ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸</button>
</p>
<input type="text" id="try" id="emp_ent" name="emp_ent" style="display: none;">
   

  <div class="form-row"> 
    <label for="sum_pay">ÑÑƒĞ¼Ğ¼Ğ° Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°:</label>
  <input type="number" id="sum_pay" name="sum_pay"  required/>
  </div>
  
<div class="form-row"> 
  <label for="pay_month" >Ğ—Ğ° Ğ¼ĞµÑÑÑ†:</label>
  <input type="month" id="pay_month" name="pay_month" required/>

</div>
  <div class="form-row">
    <label for="mySelect">Ñ‚Ğ¸Ğ¿ Ğ·Ğ¿:</label>
  <select id="mySelect" required name="mySelect">
    <option value="" disabled selected hidden>Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°</option>
    <option value="Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°">Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°</option>
    <option value="Ğ°Ğ²Ğ°Ğ½Ñ">Ğ°Ğ²Ğ°Ğ½Ñ</option>
    <option value="Ğ´Ñ€ÑƒĞ³Ğ¸">Ğ´Ñ€ÑƒĞ³Ğ¸</option>
  </select>
  </div>
  

  <label for="notes"></label>
  <textarea id="notes" name="notes" placeholder="ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ·Ğ´ĞµÑÑŒ..."></textarea>
<center>
  <input type="submit" value="Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ">
</center>
   
   </form>
</div>
 
<table id="data_table_salry">
  <tbody></tbody>
</table>
<script>
  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
  
 function lost_salry() {
  const empId = params.get("employee_id_input");
  const projId = params.get("project_id_input");
   
  fetch(`/show_salary_history?employee_id_input=${empId}&project_id_input=${projId}`)
    .then(res => res.json())
    .then(data => {
      // âœ… Ù†Ø£Ø®Ø° ÙÙ‚Ø· Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£Ø®ÙŠØ±
      const lastItem = data[data.length - 1];
      const tbody = document.querySelector('#data_table_salry tbody');
      const selEmp = Number(lastItem.sum || 0);
      const row = document.createElement('tr');
      tbody.appendChild(row);

      // âœ… ØªØ¹Ø¨Ø¦Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
      document.getElementById('show_employee_name_salry').textContent = `${lastItem.pay_method}`;
      document.getElementById('show_projact_name_salry').textContent = `${lastItem.pay_for}`;
      document.getElementById('show_sum_salry').textContent = `${lastItem.sum}`;
    })
    .catch(err => {
      document.getElementById('status').textContent = 'Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….';
      console.error(err);
    });
}

// âœ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload = function() {
    lost_salry();
    loadData();
};


</script>
 
<script>
 
  document.getElementById("goToSalaryHistoryBtn").addEventListener("click", function() {
      const employeeId = params.get("employee_id_input");
      const projectId = params.get("project_id_input");

      if (!employeeId || !projectId) {
          alert("Employee ID Ğ¸Ğ»Ğ¸ Project ID Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚!");
          return;
      }

      const url = `/show_salary_history_page?employee_id_input=${employeeId}&project_id_input=${projectId}`;
      window.location.href = url;
  });
</script>



<script>
   

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function submitForm(event) {
  event.preventDefault();

  const form = document.getElementById("employee-form");
  const formData = new FormData(form);

  fetch(`/salary_history`, {
    method: "POST",
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    const msg = document.getElementById("form-message");
    msg.textContent = data.message; // ğŸ‘ˆ Ù†Ø¹Ø±Ø¶ Ù†ÙØ³ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù† Ø¨Ø§ÙŠØ«ÙˆÙ†

    if (data.status === "success") {
      document.getElementById('employee-form').reset();
      msg.style.color = "green";
    } else {
      msg.style.color = "red";
    }

    console.log("Server response:", data);
  })
  .catch(error => {
    const msg = document.getElementById("form-message");
    msg.style.color = "red";
    msg.textContent = "âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
    console.error("Fetch error:", error);
  });
}

  </script>

</body>

</html>
<script>
  
  let role = sessionStorage.getItem("role");
  let user = sessionStorage.getItem("username");
  document.getElementById("try").value = role +" "+ user;
                if (role === "admin") {
                   
                } else if(role === "supadmin") {
                  document.getElementById("employee-form").style.display = "none";
                }else if(role === "emp") {
                    
                }else if (!role) {  // Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙØªÙ‡ Ø£Ù†Øª
                    window.location.href = "/log_in";
                }
</script>