<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <title>Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ğ½Ğ° ÑĞ¼ĞµĞ½Ñƒ</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 600px;
      margin: 40px auto;
      background-color: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
      font-size: 24px;
    }

    label {
      display: block;
      margin-top: 15px;
      margin-bottom: 6px;
      font-weight: bold;
      font-size: 14px;
      color: #222;
    }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="submit"] {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    input[type="submit"] {
      background-color: #28a745;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    input[type="submit"]:hover {
      background-color: #218838;
    }

    .message {
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
      color: red;
    }
    #video{
      max-width: 90%;
      margin: 40px auto;
    }
    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      .container {
        margin: 20px;
        padding: 20px;
      }

      h1 {
        font-size: 20px;
      }

      label, input {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      input[type="date"],
      input[type="time"],
      input[type="submit"] {
        font-size: 13px;
        padding: 10px;
      }

      h1 {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ÑĞ¼ĞµĞ½Ñƒ</h1>

    <form id="employee-form" onsubmit="submitForm(event)">
        
     
      <input type="text" id="employee_id_input" name="employee_id_input" style="display: none;">
      <input type="text" id="project_id_input" name="project_id_input" style="display: none;">
      
      <label for="project_name">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° :</label>
      <input type="text" id="project_name" name="project_name"readonly>

      <label for="employee_name">Ğ˜Ğ¼Ñ Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ½Ğ¸ĞºĞ° :</label>
      <input type="text" id="employee_name" name="employee_name"readonly>

      <label for="start_date">Ğ”ĞµĞ½ÑŒ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¼ĞµĞ½Ñ‹:</label>
      <input type="date" id="start_date" name="start_date" required >

      <label for="start_time">Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¼ĞµĞ½Ñ‹:</label>
      <input type="text" id="start_time" name="start_time" required readonly>

      <label for="end_date">Ğ”ĞµĞ½ÑŒ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ ÑĞ¼ĞµĞ½Ñ‹:</label>
      <input type="date" id="end_date" name="end_date" required readonly>

      <label for="end_time" >Ğ’Ñ€ĞµĞ¼Ñ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ ÑĞ¼ĞµĞ½Ñ‹:</label>
      <input type="time" id="end_time" name="end_time" required readonly>
<center>
   <!-- âœ… Ø§Ø®ØªÙŠØ§Ø± Ø£Ùˆ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© -->
      <video id="video" autoplay></video>
      <canvas id="canvas" style="display:block;width:90% ;height: 90%;"></canvas><br>
      <button type="button" id="captureBtn">ğŸ“¸ Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ñ„Ğ¾Ñ‚Ğ¾</button>
      <input type="hidden" name="image" id="imageData"  >
      
</center>
     
<br>
      <input type="submit" value="Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ğ½Ğ° ÑĞ¼ĞµĞ½Ñƒ">

      <div class="message" id="form-message"></div>
    </form>
  </div>
  <!--start photo-->
<script>
  
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const imageInput = document.getElementById('imageData');

// ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => {
    video.srcObject = stream;
})
.catch(err => {
  console.error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§:", err);
  alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!");
});


// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªÙ‚Ø§Ø·
document.getElementById('captureBtn').onclick = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    
    // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    ctx.drawImage(video, 0, 0);
 // Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    const now = new Date();
    const dateStr = now.toLocaleDateString();  // Ø§Ù„ØªØ§Ø±ÙŠØ®
    const timeStr = now.toLocaleTimeString();  // Ø§Ù„ÙˆÙ‚Øª
    

    // Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø«Ù„Ø§Ù‹ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù)
    ctx.font = "20px Arial";       // Ø­Ø¬Ù… ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø®Ø·
    ctx.fillStyle = "red";         // Ù„ÙˆÙ† Ø§Ù„Ù†Øµ
    ctx.fillText("Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° :- " + projectName, 50, 50); // Ø§Ù„Ù†Øµ ÙˆÙ…ÙƒØ§Ù†Ù‡ (X=50, Y=50)
    ctx.fillText("Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ½Ğ¸Ğº :- " + employeeName, 50, 70); // Ø§Ù„Ù†Øµ ÙˆÙ…ÙƒØ§Ù†Ù‡ (X=50, Y=50)
    ctx.fillText("Ğ”Ğ°Ñ‚Ğ°: " + dateStr, 50, 100);
    ctx.fillText("Ğ’Ñ€ĞµĞ¼Ñ: " + timeStr, 50, 130);
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Base64
    imageInput.value = canvas.toDataURL("image/jpeg");
    imageInput.width = 30;
    imageInput.height = video.videoHeight;
    document.getElementById('video').style.display = 'none';
    alert("âœ… Ğ¤Ğ¾Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾!");
};
</script>
  <!--end -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script> 
const params0 = new URLSearchParams(window.location.search);
   
   let workHours = params0.get("time0"); // Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… Ùˆ Ø§Ù„ØºØ¯
  const today = new Date();
  const tomorrow = new Date();
  tomorrow.setDate(today.getDate() + 1);

  const todayStr = today.toISOString().split("T")[0];
  const tomorrowStr = tomorrow.toISOString().split("T")[0];

  // Ø¶Ø¨Ø· start_date = Ø§Ù„ÙŠÙˆÙ… + Ø§Ù„ØºØ¯
  const startDateInput = document.getElementById("start_date");
  startDateInput.min = todayStr;
  startDateInput.max = tomorrowStr;
  

  const endDateInput = document.getElementById("end_date");
  endDateInput.readOnly = true;

  // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
  function calculateEndTime() {
      const startDate = startDateInput.value;
      const startTime = document.getElementById("start_time").value;

      if (!startDate || !startTime) return;

      const startDateTime = new Date(`${startDate}T${startTime}:00`);
      const endDateTime = new Date(startDateTime.getTime() + workHours * 60 * 60 * 1000);

      // Ø§Ù„ØªØ§Ø±ÙŠØ®
      const endDateStr = endDateTime.toISOString().split("T")[0];

      // Ø§Ù„ÙˆÙ‚Øª Ø¨Ù†Ø¸Ø§Ù… 24 Ø³Ø§Ø¹Ø©
      const endHours = String(endDateTime.getHours()).padStart(2, "0");
      const endMinutes = String(endDateTime.getMinutes()).padStart(2, "0");
      const endTimeStr = `${endHours}:${endMinutes}`;

      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…
      endDateInput.value = endDateStr;
      document.getElementById("end_time")._flatpickr.setDate(endTimeStr, true, "H:i");
  }

  // flatpickr Ù„Ù€ end_time
  flatpickr("#end_time", {
      enableTime: false,
      noCalendar: true,
      dateFormat: "H:i", // Ù†Ø¸Ø§Ù… 24 Ø³Ø§Ø¹Ø©
      time_24hr: true
  });

  // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± start_date Ø£Ùˆ start_time Ù†Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  startDateInput.addEventListener("change", calculateEndTime);
  document.getElementById("start_time").addEventListener("change", calculateEndTime);
</script>
<script src="/static/js/config.js"></script>
  <script>
    // Ø§Ù„ØªÙ‚Ø§Ø· Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª URL ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„
    const params = new URLSearchParams(window.location.search);
    const employeeId = params.get("employee_id");
    const projectId = params.get("project_id");
    const projectName = params.get("project_name");
    const employeeName = params.get("employee_name");
    const start_time = params.get("time");
     

    if (employeeId && projectId && projectName && employeeName) {
      document.getElementById("employee_id_input").value = employeeId;
      document.getElementById("project_id_input").value = projectId;
      document.getElementById("project_name").value = projectName;
      document.getElementById("employee_name").value = employeeName;
      document.getElementById("start_time").value = start_time;
      if (start_time.value) {
        
      } else {
        document.getElementById("form-message").textContent = "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ¼ĞµĞ½Ñ‹.";
      }
    } else {
      document.getElementById("form-message").textContent = "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ";
    }


    function submitForm(event) {
  event.preventDefault();

  const form = document.getElementById("employee-form");
  const formData = new FormData(form);
  

  // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ØºÙŠØ± ÙØ§Ø±ØºØ©
  for (let [name, value] of formData.entries()) {
    if (!value.trim()) {
      document.getElementById("form-message").textContent = `Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ ÑĞ¼ĞµĞ½Ñ‹.`;
      return; // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    }
  }

  // Ø¥Ø°Ø§ Ø§Ù„ÙƒÙ„ ØµØ­ÙŠØ­ØŒ Ù†Ø±Ø³Ù„ Ø§Ù„ÙÙˆØ±Ù…
  fetch(`${LinkP}/add_work_shifts`, {
    method: "POST",
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    document.getElementById("form-message").textContent = "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!";
    console.log(data);
  })
  .catch(error => {
    document.getElementById("form-message").textContent = "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ";
    console.error(error);
  });
}

  </script>
 
</body>
</html>
