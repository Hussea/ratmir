<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ñ‚Ğ°ÑÑ‰Ğ¸Ñ…ÑÑ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚</title>
   {% extends "try.html" %}
  {% block page_css %}
  <style>
   /* ===== RESET Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ===== */
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  overflow-x: hidden; /* ğŸ”¥ ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ´ÙˆÙŠÙ‡ */
  font-family: "Poppins", Arial, sans-serif;
  background-color: #f4f6f9;
}

/* ===== Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ===== */
center {
  width: 100%;
  padding: 10px;
}

/* ===== Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ===== */
h2 {
  font-size: 24px;
  margin: 15px 0;
  text-align: center;
  color: #2d3436;
}

/* ===== Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ù„ÙˆÙŠ ===== */
#info_line {
  width: 100%;
  text-align: center;
  font-size: 15px;
  line-height: 1.6;
  padding: 10px;
  background: #ffffff;
  border-radius: 10px;
  margin-bottom: 15px;
}

/* ===== Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
input[type="month"],
button {
  width: 100%;
  max-width: 300px;
  padding: 10px;
  margin: 6px auto;
  display: block;
  font-size: 15px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  background-color: #0984e3;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #0652dd;
}

/* ===== Ø§Ù„Ø­Ø§Ù„Ø© ===== */
#status {
  font-size: 14px;
  margin: 10px 0;
}

/* ================= TABLE DESKTOP ================= */
table {
  width: 95%;
  margin: 20px auto;
  border-collapse: collapse;
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

th {
  background-color: #dfe6e9;
  padding: 12px;
  font-size: 14px;
}

td {
  padding: 10px;
  font-size: 13px;
  text-align: center;
  word-break: break-word;
}

/* ================= MOBILE ================= */
@media (max-width: 768px) {

  /* ğŸ”¥ Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ ØªÙ…Ø¯Ø¯ Ø£Ùˆ ØªØ´ÙˆÙŠÙ‡ */
  table,
  thead,
  tbody,
  tr,
  th,
  td {
    display: block;
    width: 100%;
  }

  thead {
    display: none;
  }

  table {
    background: transparent;
    box-shadow: none;
  }

  tr {
    background: white;
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  }

  td {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 8px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    text-align: right;
  }

  td:last-child {
    border-bottom: none;
  }

  td::before {
    content: attr(data-label);
    font-weight: bold;
    color: #636e72;
    margin-left: 10px;
    white-space: nowrap;
  }

  /* ===== ØªØµØºÙŠØ± Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ===== */
  td {
    max-width: 100%;
    overflow-wrap: break-word;
  }
}

/* ===== Ø£Ø¬Ù‡Ø²Ø© ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ ===== */
@media (max-width: 480px) {
  h2 {
    font-size: 20px;
  }

  td {
    font-size: 13px;
  }
}

</style>
{% endblock %}

<body>
    {% block content %}

<center>
  <br>
  <label for="start_day"> Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ğ´ Ğ¸ Ğ¼ĞµÑÑÑ†:</label>
 <input type="month" id="start_day" />
 
 <button onclick="loadData()">ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ</button>
<h2>Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ñ‚Ğ°ÑÑ‰Ğ¸Ñ…ÑÑ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚</h2>
<p id="status">Ğ’ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°.</p>
<p id="info_line">
   
  <span><strong> Ğ’ ĞĞ±ĞµĞºÑ‚:</strong> <span id="show_projact_name"></span></span> |
  <span><strong> ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚:</strong> <span id="show_shift"></span></span> |
  <span><strong> ÑÑƒĞ¼Ğ° :</strong> <span id="show_sum"></span></span> 
</p>

<table id="data-table">
  <thead>
    <tr>
      <th>name</th>
      <th>Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°</th>
      <th>Ğ·Ğ° Ğ¼ĞµÑÑÑ†</th>
      <th>ÑÑƒĞ¼Ğ°</th>
      <th>Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¸Ğº ÑĞ¼ĞµĞ½Ğ°</th>
      <th>Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ</th>
      <th>ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</center>


<script>

 // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
  const today = new Date();
  // ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ ØµÙŠØºØ© YYYY-MM
  const month = today.toISOString().slice(0, 7);
  // ØªØ¹ÙŠÙŠÙ†Ù‡ ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù…Ø¯Ø®Ù„
  document.getElementById("start_day").value = month;
        //=====================

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
  const params = new URLSearchParams(window.location.search);
  

  function loadData() {
   
   const datas = document.getElementById('start_day').value;
   const projId = params.get("id");
   
    
    if (!datas || !projId ) {
      document.getElementById('status').textContent = 'âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¹.';
      return;
    }

    let apiUrl = `/show_salary_history?datas=${datas}&project_id_input=${projId}`;

    
    document.getElementById('status').textContent = 'ğŸ”„ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
    document.getElementById('data-table').style.display = 'none';
    document.querySelector('#data-table tbody').innerHTML = '';

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        if (!data || data.length === 0) {
          document.getElementById('status').textContent = 'ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ².';
          return;
        }

        const tbody = document.querySelector('#data-table tbody');
        let total = 0;

        data.forEach(item => {
          const row = document.createElement('tr');
          const selEmp = Number(item.sum || 0);
          total += selEmp;

          row.innerHTML = `
            <td data-label="name">${item.employee_name || "-"}</td>
            <td data-label="Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ°">${item.pay_method || "-"}</td>
            <td data-label="Ğ·Ğ° Ğ¼ĞµÑÑÑ†">${item.pay_for || "-"}</td>
            <td data-label="ÑÑƒĞ¼Ğ°">${item.sum || "-"}</td>
            <td data-label="Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¸Ğº ÑĞ¼ĞµĞ½Ğ°">${item.responsible_emp_id || "-"}</td>
            <td data-label="Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ">${item.nots || "-"}</td>
            <td data-label="ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ">${item.done_or_not || "-"}</td>
          `;
          tbody.appendChild(row);
          
          document.getElementById('show_projact_name').textContent = `${item.projuct_title}`;
        });

        document.getElementById('data-table').style.display = 'table';
        document.getElementById('status').style.display = 'none';
        document.getElementById('show_shift').textContent = `${data.length}`;
        document.getElementById('show_sum').textContent = `${total}`;

      })
      .catch(err => {
        document.getElementById('status').textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
        console.error(err);
      });
      
  }
      window.onload = loadData;

</script>



</body>
</html>
<script> 
  let role = sessionStorage.getItem("role");
                if (role === "admin") {
                   
                } else if(role === "supadmin") {
                  
                }else if(role === "emp") {
                   
                }else if (!role) {  // Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙØªÙ‡ Ø£Ù†Øª
                    window.location.href = "/log_in";
                } 
</script>
{% endblock %}